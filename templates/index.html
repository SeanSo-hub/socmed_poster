<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Socmed Poster</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .container {
        width: 100%;
        max-width: 600px;
        background: white;
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(45deg, #1877f2, #42a5f5);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
      }

      .header p {
        opacity: 0.9;
        font-size: 1.1em;
      }

      .content {
        padding: 40px;
      }

      .form-group {
        margin-bottom: 25px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #333;
      }

      textarea,
      input[type="url"],
      select,
      input[type="file"] {
        width: 100%;
        padding: 15px;
        border: 2px solid #e1e5e9;
        border-radius: 10px;
        font-size: 16px;
        transition: border-color 0.3s ease;
        resize: vertical;
        background: white;
      }

      textarea:focus,
      input[type="url"]:focus,
      select:focus,
      input[type="file"]:focus {
        outline: none;
        border-color: #1877f2;
      }

      .file-info {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
      }

      .preview-container {
        margin-top: 10px;
        text-align: center;
      }

      .preview-image {
        max-width: 100%;
        max-height: 200px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .preview-video {
        max-width: 100%;
        max-height: 200px;
        border-radius: 10px;
      }

      textarea {
        min-height: 120px;
        font-family: inherit;
      }

      .btn {
        background: linear-gradient(45deg, #1877f2, #42a5f5);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        width: 100%;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(24, 119, 242, 0.3);
      }

      .btn:active {
        transform: translateY(0);
      }

      .flash-messages {
        margin-bottom: 20px;
      }

      .flash {
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 10px;
        font-weight: 500;
      }

      .flash.success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .flash.error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
      }

      .status-online {
        background: #28a745;
        box-shadow: 0 0 10px rgba(40, 167, 69, 0.5);
      }

      .status-offline {
        background: #dc3545;
        box-shadow: 0 0 10px rgba(220, 53, 69, 0.5);
      }

      .footer {
        text-align: center;
        padding: 20px;
        color: #666;
        font-size: 14px;
      }

      .char-count {
        text-align: right;
        font-size: 12px;
        color: #666;
        margin-top: 5px;
      }

      @media (max-width: 768px) {
        .container {
          margin: 10px;
          border-radius: 10px;
        }

        .header {
          padding: 20px;
        }

        .header h1 {
          font-size: 2em;
        }

        .content {
          padding: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üì± SocMed Poster</h1>
        <p>Post messages to your Facebook page</p>
        <div id="status" style="margin-top: 15px">
          <span class="status-indicator status-offline"></span>
          <span>Checking connection...</span>
        </div>
      </div>

      <div class="content">
        <div class="flash-messages">
          {% with messages = get_flashed_messages(with_categories=true) %} {% if
          messages %} {% for category, message in messages %}
          <div class="flash {{ category }}">{{ message }}</div>
          {% endfor %} {% endif %} {% endwith %}
        </div>

        <form
          method="POST"
          action="{{ url_for('post_message') }}"
          enctype="multipart/form-data"
        >
          <div class="form-group">
            <label for="message" id="message-label">üìù Caption</label>
            <textarea
              id="message"
              name="message"
              placeholder="What's on your mind?"
              maxlength="63206"
              oninput="updateCharCount()"
            ></textarea>
            <div class="char-count">
              <span id="char-count">0</span> / 63,206 characters
            </div>
          </div>

          <div class="form-group">
            <label for="media_file">üìé Add Photo or Video (optional)</label>
            <input
              type="file"
              id="media_file"
              name="media_file"
              accept="image/*,video/*"
              onchange="previewFile()"
            />
            <div class="file-info">
              Supported: Images (PNG, JPG, GIF, WebP) ‚Ä¢ Videos (MP4, AVI, MOV,
              WMV, WebM)
            </div>
            <div id="media-preview"></div>
          </div>

          <!-- <div class="form-group">
            <label for="link">üîó Link (optional)</label>
            <input
              type="url"
              id="link"
              name="link"
              placeholder="https://example.com"
            />
          </div> -->

          <button type="submit" class="btn">Post to Facebook</button>
        </form>
      </div>

      <div class="footer">
        Made with ‚ù§Ô∏è using Flask ‚Ä¢ Check your Facebook page to see posts
      </div>
    </div>

    <script>
      // Update character count
      function updateCharCount() {
        const textarea = document.getElementById("message");
        const charCount = document.getElementById("char-count");
        charCount.textContent = textarea.value.length;
      }

      // Preview uploaded files
      function previewFile() {
        const fileInput = document.getElementById("media_file");
        const previewDiv = document.getElementById("media-preview");
        const file = fileInput.files[0];

        if (file) {
          const reader = new FileReader();
          const isImage = file.type.startsWith("image/");
          const isVideo = file.type.startsWith("video/");

          reader.onload = function (e) {
            if (isImage) {
              previewDiv.innerHTML = `
                <div class="preview-container">
                  <img src="${
                    e.target.result
                  }" alt="Preview" class="preview-image">
                  <div class="file-info">üì∑ ${file.name} (${(
                file.size /
                1024 /
                1024
              ).toFixed(2)} MB)</div>
                </div>
              `;
            } else if (isVideo) {
              previewDiv.innerHTML = `
                <div class="preview-container">
                  <video controls class="preview-video">
                    <source src="${e.target.result}" type="${file.type}">
                    Your browser does not support the video tag.
                  </video>
                  <div class="file-info">üé¨ ${file.name} (${(
                file.size /
                1024 /
                1024
              ).toFixed(2)} MB)</div>
                </div>
              `;
            } else {
              previewDiv.innerHTML = `
                <div class="file-info">‚ùå Unsupported file type: ${file.type}</div>
              `;
            }
          };
          reader.readAsDataURL(file);
        } else {
          previewDiv.innerHTML = "";
        }
      }

      // Check connection status
      async function checkStatus() {
        try {
          const response = await fetch("/status");
          const data = await response.json();
          const statusElement = document.getElementById("status");

          if (data.token_valid && data.page_access) {
            statusElement.innerHTML = `
                        <span class="status-indicator status-online"></span>
                        <span>Connected to Facebook Page: ${data.page_name}</span>
                    `;
          } else {
            statusElement.innerHTML = `
                        <span class="status-indicator status-offline"></span>
                        <span>Connection failed - Check credentials</span>
                    `;
          }
        } catch (error) {
          const statusElement = document.getElementById("status");
          statusElement.innerHTML = `
                    <span class="status-indicator status-offline"></span>
                    <span>Unable to check status</span>
                `;
        }
      }

      // Check status when page loads
      window.onload = function () {
        checkStatus();
        updateCharCount();
      };

      // Auto-resize textarea
      const textarea = document.getElementById("message");
      textarea.addEventListener("input", function () {
        this.style.height = "auto";
        this.style.height = Math.min(this.scrollHeight, 300) + "px";
      });
    </script>
  </body>
</html>
