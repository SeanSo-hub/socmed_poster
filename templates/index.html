<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Socmed Poster</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              facebook: "#1877f2",
              twitter: "#1da1f2",
            },
          },
        },
      };
    </script>
  </head>
  <body
    class="min-h-screen bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 p-5 flex items-center justify-center font-sans"
  >
    <div
      class="w-full max-w-2xl bg-white rounded-2xl shadow-2xl overflow-hidden"
    >
      <div
        class="bg-gradient-to-r from-facebook to-blue-500 text-white p-8 text-center"
      >
        <h1 class="text-4xl font-bold mb-3">üì± SocMed Poster</h1>
        <p id="header-description" class="opacity-90 text-lg">
          Post messages to your social media
        </p>
        <div id="status" class="mt-4 flex items-center justify-center">
          <span class="status-indicator status-offline"></span>
          <span>Checking connection...</span>
        </div>
      </div>

      <div class="bg-gray-50 p-5 border-b border-gray-200">
        <div class="flex gap-3 justify-center items-center">
          <input
            type="radio"
            id="facebook"
            name="platform"
            value="facebook"
            class="hidden"
            checked
          />
          <label
            for="facebook"
            class="platform-btn facebook-btn flex items-center gap-2 px-6 py-3 rounded-full cursor-pointer transition-all duration-300 font-semibold text-sm border-2 min-w-[120px] justify-center bg-blue-50 text-facebook border-facebook hover:scale-105 hover:shadow-lg"
          >
            <span class="text-base">üìò</span>
            Facebook
          </label>

          <input
            type="radio"
            id="twitter"
            name="platform"
            value="twitter"
            class="hidden"
          />
          <label
            for="twitter"
            class="platform-btn twitter-btn flex items-center gap-2 px-6 py-3 rounded-full cursor-pointer transition-all duration-300 font-semibold text-sm border-2 min-w-[120px] justify-center bg-sky-50 text-twitter border-twitter hover:scale-105 hover:shadow-lg"
          >
            <span class="text-base">üê¶</span>
            Twitter
          </label>
        </div>
      </div>

      <div class="p-10">
        <div class="mb-5">
          {% with messages = get_flashed_messages(with_categories=true) %} {% if
          messages %} {% for category, message in messages %}
          <div
            class="flash {{ category }} p-4 rounded-lg mb-3 font-medium
              {% if category == 'success' %}
                bg-green-100 text-green-800 border border-green-200
              {% else %}
                bg-red-100 text-red-800 border border-red-200
              {% endif %}"
          >
            {{ message }}
          </div>
          {% endfor %} {% endif %} {% endwith %}
        </div>

        <form
          method="POST"
          action="{{ url_for('post_message') }}"
          enctype="multipart/form-data"
          id="post-form"
          class="space-y-6"
        >
          <input
            type="hidden"
            id="selected-platform"
            name="platform"
            value="facebook"
          />

          <div class="space-y-2">
            <label
              for="message"
              id="message-label"
              class="block mb-2 font-semibold text-gray-700"
              >üìù Caption</label
            >
            <textarea
              id="message"
              name="message"
              placeholder="What's on your mind?"
              maxlength="63206"
              oninput="updateCharCount()"
              class="w-full p-4 border-2 border-gray-200 rounded-xl text-base transition-colors duration-300 resize-y min-h-[120px] focus:outline-none focus:border-facebook"
            ></textarea>
            <div class="text-right text-sm text-gray-600 mt-1">
              <span id="char-count">0</span> /
              <span id="char-limit">63,206</span> characters
            </div>
          </div>

          <div class="space-y-2">
            <label
              for="media_file"
              class="block mb-2 font-semibold text-gray-700"
              >üìé Add Photo or Video (optional)</label
            >
            <input
              type="file"
              id="media_file"
              name="media_file"
              accept="image/*,video/*"
              onchange="previewFile()"
              class="w-full p-4 border-2 border-gray-200 rounded-xl text-base transition-colors duration-300 bg-white focus:outline-none focus:border-facebook"
            />
            <div class="text-xs text-gray-500 mt-1">
              Supported: Images (PNG, JPG, GIF, WebP) ‚Ä¢ Videos (MP4, AVI, MOV,
              WMV, WebM)
            </div>
            <div id="media-preview" class="mt-3"></div>
          </div>

          <button
            type="submit"
            id="submit-btn"
            class="w-full bg-gradient-to-r from-facebook to-blue-500 text-white border-none p-4 rounded-xl text-base font-semibold cursor-pointer transition-all duration-200 hover:-translate-y-0.5 hover:shadow-lg active:translate-y-0 flex items-center justify-center gap-2"
          >
            <span id="submit-icon">üìò</span>
            <span id="submit-text">Post to Facebook</span>
          </button>
        </form>
      </div>

      <div
        class="text-center p-5 text-gray-600 text-sm border-t border-gray-100"
      >
        Made with ‚ù§Ô∏è using Flask ‚Ä¢ Check your social media to see posts
      </div>
    </div>

    <!-- Custom styles for status indicators and platform switching -->
    <style>
      .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
      }

      .status-online {
        background: #10b981;
        box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
      }

      .status-offline {
        background: #ef4444;
        box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
      }

      /* Platform switching styles */
      input[type="radio"]:checked + .facebook-btn {
        background-color: #1877f2 !important;
        color: white !important;
        transform: scale(1.05);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      }

      input[type="radio"]:checked + .twitter-btn {
        background-color: #1da1f2 !important;
        color: white !important;
        transform: scale(1.05);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      }

      /* Preview styles */
      .preview-container {
        margin-top: 12px;
        text-align: center;
      }

      .preview-image {
        max-width: 100%;
        max-height: 200px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .preview-video {
        max-width: 100%;
        max-height: 200px;
        border-radius: 8px;
      }
    </style>

    <script>
      // Platform switching functionality
      function switchPlatform(platform) {
        const facebookBtn = document.querySelector('label[for="facebook"]');
        const twitterBtn = document.querySelector('label[for="twitter"]');
        const submitBtn = document.getElementById("submit-btn");
        const submitIcon = document.getElementById("submit-icon");
        const submitText = document.getElementById("submit-text");
        const hiddenInput = document.getElementById("selected-platform");
        const headerDesc = document.getElementById("header-description");
        const messageTextarea = document.getElementById("message");
        const charLimit = document.getElementById("char-limit");

        if (platform === "facebook") {
          submitIcon.textContent = "üìò";
          submitText.textContent = "Post to Facebook";
          submitBtn.style.background =
            "linear-gradient(45deg, #1877f2, #42a5f5)";
          headerDesc.textContent = "Post messages to your Facebook page";
          messageTextarea.maxLength = 63206;
          charLimit.textContent = "63,206";
          messageTextarea.placeholder = "What's on your mind?";
        } else {
          submitIcon.textContent = "üê¶";
          submitText.textContent = "Post to Twitter";
          submitBtn.style.background =
            "linear-gradient(45deg, #1da1f2, #1991db)";
          headerDesc.textContent = "Post tweets to your Twitter account";
          messageTextarea.maxLength = 280;
          charLimit.textContent = "280";
          messageTextarea.placeholder = "What's happening?";
        }

        hiddenInput.value = platform;
        updateCharCount();
      }

      // Update character count
      function updateCharCount() {
        const textarea = document.getElementById("message");
        const charCount = document.getElementById("char-count");
        const currentLength = textarea.value.length;
        const platform = document.getElementById("selected-platform").value;
        const maxLength = platform === "facebook" ? 63206 : 280;

        charCount.textContent = currentLength;

        // Color coding for Twitter character limit
        if (platform === "twitter") {
          if (currentLength > 280) {
            charCount.style.color = "#dc3545";
          } else if (currentLength > 250) {
            charCount.style.color = "#ffc107";
          } else {
            charCount.style.color = "#666";
          }
        } else {
          charCount.style.color = "#666";
        }
      }

      // Preview uploaded files
      function previewFile() {
        const fileInput = document.getElementById("media_file");
        const previewDiv = document.getElementById("media-preview");
        const file = fileInput.files[0];

        if (file) {
          const reader = new FileReader();
          const isImage = file.type.startsWith("image/");
          const isVideo = file.type.startsWith("video/");

          reader.onload = function (e) {
            if (isImage) {
              previewDiv.innerHTML = `
                <div class="preview-container">
                  <img src="${
                    e.target.result
                  }" alt="Preview" class="preview-image">
                  <div class="file-info">üì∑ ${file.name} (${(
                file.size /
                1024 /
                1024
              ).toFixed(2)} MB)</div>
                </div>
              `;
            } else if (isVideo) {
              previewDiv.innerHTML = `
                <div class="preview-container">
                  <video controls class="preview-video">
                    <source src="${e.target.result}" type="${file.type}">
                    Your browser does not support the video tag.
                  </video>
                  <div class="file-info">üé¨ ${file.name} (${(
                file.size /
                1024 /
                1024
              ).toFixed(2)} MB)</div>
                </div>
              `;
            } else {
              previewDiv.innerHTML = `
                <div class="file-info">‚ùå Unsupported file type: ${file.type}</div>
              `;
            }
          };
          reader.readAsDataURL(file);
        } else {
          previewDiv.innerHTML = "";
        }
      }

      // Check connection status
      async function checkStatus() {
        try {
          const response = await fetch("/status");
          const data = await response.json();
          const statusElement = document.getElementById("status");
          const currentPlatform =
            document.getElementById("selected-platform").value;

          if (currentPlatform === "facebook") {
            if (data.facebook.token_valid && data.facebook.page_access) {
              statusElement.innerHTML = `
                <span class="status-indicator status-online"></span>
                <span>Connected to Facebook Page: ${data.facebook.page_name}</span>
              `;
            } else {
              statusElement.innerHTML = `
                <span class="status-indicator status-offline"></span>
                <span>Facebook connection failed - Check credentials</span>
              `;
            }
          } else {
            if (data.twitter.credentials_valid) {
              statusElement.innerHTML = `
                <span class="status-indicator status-online"></span>
                <span>Connected to Twitter</span>
              `;
            } else {
              statusElement.innerHTML = `
                <span class="status-indicator status-offline"></span>
                <span>Twitter connection failed - Check credentials</span>
              `;
            }
          }
        } catch (error) {
          const statusElement = document.getElementById("status");
          statusElement.innerHTML = `
            <span class="status-indicator status-offline"></span>
            <span>Unable to check status</span>
          `;
        }
      }

      // Platform toggle event listeners
      document.addEventListener("DOMContentLoaded", function () {
        const platformRadios = document.querySelectorAll(
          'input[name="platform"]'
        );

        platformRadios.forEach((radio) => {
          radio.addEventListener("change", function () {
            switchPlatform(this.value);
            checkStatus();
          });
        });
      });

      // Check status when page loads
      window.onload = function () {
        switchPlatform("facebook"); // Initialize with Facebook
        checkStatus();
        updateCharCount();
      };

      // Auto-resize textarea
      const textarea = document.getElementById("message");
      textarea.addEventListener("input", function () {
        this.style.height = "auto";
        this.style.height = Math.min(this.scrollHeight, 300) + "px";
      });
    </script>
  </body>
</html>
